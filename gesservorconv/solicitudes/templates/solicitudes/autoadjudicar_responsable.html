{% extends "base_cuentas.html" %}

{% load cui %}

{% block titulo %}Apuntarse en Solicitud de Servicio{% endblock %}

{% block contenido %}
<ol class="breadcrumb m-2">
    <li class="breadcrumb-item">
        <a href="{% url 'cuentas:perfil' %}">
            Perfiles
        </a>
    </li>
    <li class="breadcrumb-item">
        <a href="{% url 'cuentas:responsable_tecnico' %}">
            Responsable Técnico
        </a>
    </li>
    <li class="breadcrumb-item">
        <a href="{% url 'solicitudes:lista_solicitudes_responsable' %}">
            Solicitudes
        </a>
    </li>
    <li class="breadcrumb-item active">{{ solicitud_servicio.id_solicitud }}</li>
    <li class="breadcrumb-item" aria-current="page">Apuntarse</li>
</ol>
<h2 class="text-center">Apuntarse en Solicitud de Servicio</h2>
<form method="post" id="formulario">
    {% csrf_token %}
    <div class="form-text text-center">¿Desea apuntarse en la siguiente solicitud de servicio?</div>
    <table class="mx-auto container">
        <tr class="row justify-content-start">
            <td class="col-auto">
                <div class="form-floating">
                    <input type="text" class="form-control-plaintext"
                        id="nombre_solicitud" readonly
                        value="{{ solicitud_servicio.nombre_solicitud }}"
                        size="{{ solicitud_servicio.nombre_solicitud|length }}"
                    >
                    <label for="nombre_solicitud">Nombre</label>
                </div>
            </td>
        </tr>
        <tr class="row justify-content-start">
            <td class="col-auto">
                <div class="form-floating">
                    <textarea class="form-control-plaintext"
                        id="descripcion_solicitud" readonly
                    >{{ solicitud_servicio.descripcion_solicitud }}</textarea>
                    <label for="descripcion_solicitud">Descripción</label>
                </div>
            </td>
        </tr>
        <tr class="row justify-content-start">
            <td class="col-auto">
                <div class="form-floating">
                    <select class="form-select"
                        id="id_organizacion_responsable_tecnico"
                        name="organizacion_responsable_tecnico"
                        required
                    >
                        {% if usuario_responsable.habilitado_responsable is True %}
                        <option value="0">
                            CUIL: {{ usuario_responsable.cuil_responsable|cuil }} (persona física)
                        </option>
                        {% endif %}
                        {% for organizacion in usuario_responsable.cuit_organizaciones_responsable %}
                        {% with razon_social=usuario_responsable.razones_sociales_responsable|enesimo:forloop.counter0 %}
                        {% with puesto=usuario_responsable.puestos_organizaciones_responsable|enesimo:forloop.counter0 %}
                        {% with habilitado=usuario_responsable.habilitado_organizaciones_responsable|enesimo:forloop.counter0 %}
                        {% if habilitado is True %}
                        <option value="{{ forloop.counter }}">
                            {{ puesto }} - {{ razon_social }}. CUIT: {{ organizacion|cuit }}
                        </option>
                        {% endif %}
                        {% endwith %}
                        {% endwith %}
                        {% endwith %}
                        {% endfor %}
                    </select>
                    <label for="id_organizacion_responsable_tecnico">Rol</label>
                </div>
            </td>
        </tr>
    </table>
</form>
<div class="container mt-5">
    <div class="row justify-content-start gap-2">
        <a href="{% url 'solicitudes:lista_solicitudes_responsable' %}"
            class="col-auto" tabindex="-1"
        >
            <input type="button"
                class="btn btn-outline-secondary btn-lg text-wrap"
                value="Volver a lista de solicitudes"
            >
        </a>
        <input type="submit" form="formulario"
            class="btn btn-success btn-lg col-auto"
            value="Apuntarse"
        >
    </div>
</div>
{% endblock %}
